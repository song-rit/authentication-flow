<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1400px" preserveAspectRatio="none" style="width:1564px;height:1400px;background:#FFFFFF;" version="1.1" viewBox="0 0 1564 1400" width="1564px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="353" x="612.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="343" x="617.75" y="27.9951">Autentication (username / password) flow</text><rect fill="#DDDDDD" height="1344.6328" style="stroke:#181818;stroke-width:0.5;" width="788.5" x="380" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="736.25" y="55.3638">K8S_ZONE</text><rect fill="#DDDDDD" height="1344.6328" style="stroke:#181818;stroke-width:0.5;" width="348" x="1210.5" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="76" x="1346.5" y="55.3638">EC2_ZONE</text><rect fill="#FFFFFF" height="1104.0742" style="stroke:#181818;stroke-width:1.0;" width="10" x="227" y="134.7266"/><rect fill="#FFFFFF" height="1034.543" style="stroke:#181818;stroke-width:1.0;" width="10" x="530" y="204.2578"/><rect fill="#FFFFFF" height="836.2148" style="stroke:#181818;stroke-width:1.0;" width="10" x="865.5" y="402.5859"/><rect fill="#FFFFFF" height="32.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="552.5156"/><rect fill="#FFFFFF" height="112.0977" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="1027.6055"/><rect fill="#FFFFFF" height="220.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="1346" y="680.3125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1521" y="799.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="232" x2="232" y1="124.7266" y2="1322.6328"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="535" x2="535" y1="124.7266" y2="1322.6328"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="870" x2="870" y1="124.7266" y2="1322.6328"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1128.5" x2="1128.5" y1="124.7266" y2="1322.6328"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1350.5" x2="1350.5" y1="124.7266" y2="1322.6328"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1525.5" x2="1525.5" y1="124.7266" y2="1322.6328"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="210" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="217" y="113.4248">web</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="210" y="1321.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="217" y="1341.6279">web</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="484" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="491" y="113.4248">bff_web_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="484" y="1321.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="491" y="1341.6279">bff_web_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="796" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="803" y="113.4248">authentication_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="796" y="1321.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="803" y="1341.6279">authentication_api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1092.5" y="121.4248">k8s_redis</text><path d="M1110.5,72.4297 C1110.5,62.4297 1128.5,62.4297 1128.5,62.4297 C1128.5,62.4297 1146.5,62.4297 1146.5,72.4297 L1146.5,98.4297 C1146.5,108.4297 1128.5,108.4297 1128.5,108.4297 C1128.5,108.4297 1110.5,108.4297 1110.5,98.4297 L1110.5,72.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1110.5,72.4297 C1110.5,82.4297 1128.5,82.4297 1128.5,82.4297 C1128.5,82.4297 1146.5,82.4297 1146.5,72.4297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1092.5" y="1334.6279">k8s_redis</text><path d="M1110.5,1347.9297 C1110.5,1337.9297 1128.5,1337.9297 1128.5,1337.9297 C1128.5,1337.9297 1146.5,1337.9297 1146.5,1347.9297 L1146.5,1373.9297 C1146.5,1383.9297 1128.5,1383.9297 1128.5,1383.9297 C1128.5,1383.9297 1110.5,1383.9297 1110.5,1373.9297 L1110.5,1347.9297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1110.5,1347.9297 C1110.5,1357.9297 1128.5,1357.9297 1128.5,1357.9297 C1128.5,1357.9297 1146.5,1357.9297 1146.5,1347.9297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1314.5" y="93.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1321.5" y="113.4248">user_api</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="1314.5" y="1321.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1321.5" y="1341.6279">user_api</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1497.5" y="121.4248">ec2_db</text><path d="M1508,72.4297 C1508,62.4297 1526,62.4297 1526,62.4297 C1526,62.4297 1544,62.4297 1544,72.4297 L1544,98.4297 C1544,108.4297 1526,108.4297 1526,108.4297 C1526,108.4297 1508,108.4297 1508,98.4297 L1508,72.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1508,72.4297 C1508,82.4297 1526,82.4297 1526,82.4297 C1526,82.4297 1544,82.4297 1544,72.4297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="1497.5" y="1334.6279">ec2_db</text><path d="M1508,1347.9297 C1508,1337.9297 1526,1337.9297 1526,1337.9297 C1526,1337.9297 1544,1337.9297 1544,1347.9297 L1544,1373.9297 C1544,1383.9297 1526,1383.9297 1526,1383.9297 C1526,1383.9297 1508,1383.9297 1508,1373.9297 L1508,1347.9297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1508,1347.9297 C1508,1357.9297 1526,1357.9297 1526,1357.9297 C1526,1357.9297 1544,1357.9297 1544,1347.9297 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="1104.0742" style="stroke:#181818;stroke-width:1.0;" width="10" x="227" y="134.7266"/><rect fill="#FFFFFF" height="1034.543" style="stroke:#181818;stroke-width:1.0;" width="10" x="530" y="204.2578"/><rect fill="#FFFFFF" height="836.2148" style="stroke:#181818;stroke-width:1.0;" width="10" x="865.5" y="402.5859"/><rect fill="#FFFFFF" height="32.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="552.5156"/><rect fill="#FFFFFF" height="112.0977" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123.5" y="1027.6055"/><rect fill="#FFFFFF" height="220.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="1346" y="680.3125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1521" y="799.9766"/><polygon fill="#181818" points="518,200.2578,528,204.2578,518,208.2578,522,204.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="237" x2="524" y1="204.2578" y2="204.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="244" y="199.1919">/api/v1/auth/signInWithPassword</text><path d="M5,139.7266 L5,254.7266 L222,254.7266 L222,149.7266 L212,139.7266 L5,139.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M212,139.7266 L212,149.7266 L222,149.7266 L212,139.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="11" y="156.7935">Reuqest header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="11" y="171.9263">Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="11" y="187.0591"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="11" y="202.1919">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="11" y="217.3247">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="11" y="232.4575">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="11" y="247.5903"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="540" x2="582" y1="281.7891" y2="281.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="582" x2="582" y1="281.7891" y2="294.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="541" x2="582" y1="294.7891" y2="294.7891"/><polygon fill="#181818" points="551,290.7891,541,294.7891,551,298.7891,547,294.7891" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="547" y="276.7231">validate request</text><polygon fill="#181818" points="853.5,398.5859,863.5,402.5859,853.5,406.5859,857.5,402.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="540" x2="859.5" y1="402.5859" y2="402.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="547" y="397.52">/api/v1/auth/login</text><path d="M176,307.7891 L176,483.7891 L525,483.7891 L525,317.7891 L515,307.7891 L176,307.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M515,307.7891 L515,317.7891 L525,317.7891 L515,307.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="324.856"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="182" y="339.9888">Request header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="182" y="355.1216">Content-Type: application/x-www-form-urlencoded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="370.2544"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="182" y="385.3872">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="182" y="400.52">- client_id: bff_web</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="182" y="415.6528">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="182" y="430.7856">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="182" y="445.9185">- grant_type: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="182" y="461.0513">- scope: bff_web</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="182" y="476.1841"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="875.5" x2="917.5" y1="510.3828" y2="510.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="917.5" x2="917.5" y1="510.3828" y2="523.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="876.5" x2="917.5" y1="523.3828" y2="523.3828"/><polygon fill="#181818" points="886.5,519.3828,876.5,523.3828,886.5,527.3828,882.5,523.3828" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="882.5" y="505.3169">validate request</text><polygon fill="#181818" points="1111.5,548.5156,1121.5,552.5156,1111.5,556.5156,1115.5,552.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="875.5" x2="1117.5" y1="552.5156" y2="552.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="882.5" y="547.4497">check existing users from k8s_redis</text><polygon fill="#181818" points="886.5,580.6484,876.5,584.6484,886.5,588.6484,882.5,584.6484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="880.5" x2="1127.5" y1="584.6484" y2="584.6484"/><path d="M1138,565.5156 L1138,605.5156 L1271,605.5156 L1271,575.5156 L1261,565.5156 L1138,565.5156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1261,565.5156 L1261,575.5156 L1271,575.5156 L1261,565.5156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="1144" y="582.5825">Redis object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="1144" y="597.7153">- user_id: xxxxxx</text><polygon fill="#181818" points="1334,676.3125,1344,680.3125,1334,684.3125,1338,680.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="875.5" x2="1340" y1="680.3125" y2="680.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="882.5" y="675.2466">/api/v1/validate-credentials</text><path d="M643,615.7813 L643,730.7813 L860,730.7813 L860,625.7813 L850,615.7813 L643,615.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M850,615.7813 L850,625.7813 L860,625.7813 L850,615.7813 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="649" y="632.8481">Reuqest header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="649" y="647.981">Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="649" y="663.1138"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="649" y="678.2466">Request body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="649" y="693.3794">- username: username</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="649" y="708.5122">- password: password</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="649" y="723.645"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="1356" x2="1398" y1="757.8438" y2="757.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="1398" x2="1398" y1="757.8438" y2="770.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="1357" x2="1398" y1="770.8438" y2="770.8438"/><polygon fill="#181818" points="1367,766.8438,1357,770.8438,1367,774.8438,1363,770.8438" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1363" y="752.7778">validate reqiest</text><polygon fill="#181818" points="1509,795.9766,1519,799.9766,1509,803.9766,1513,799.9766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1356" x2="1515" y1="799.9766" y2="799.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="1363" y="794.9106">query by username</text><polygon fill="#181818" points="1367,825.1094,1357,829.1094,1367,833.1094,1363,829.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1361" x2="1525" y1="829.1094" y2="829.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="1373" y="824.0435">return</text><line style="stroke:#181818;stroke-width:1.0;" x1="1356" x2="1398" y1="858.2422" y2="858.2422"/><line style="stroke:#181818;stroke-width:1.0;" x1="1398" x2="1398" y1="858.2422" y2="871.2422"/><line style="stroke:#181818;stroke-width:1.0;" x1="1357" x2="1398" y1="871.2422" y2="871.2422"/><polygon fill="#181818" points="1367,867.2422,1357,871.2422,1367,875.2422,1363,871.2422" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="1363" y="853.1763">validate credentails</text><polygon fill="#181818" points="886.5,896.375,876.5,900.375,886.5,904.375,882.5,900.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="880.5" x2="1350" y1="900.375" y2="900.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="892.5" y="895.3091">return</text><line style="stroke:#181818;stroke-width:1.0;" x1="875.5" x2="917.5" y1="929.5078" y2="929.5078"/><line style="stroke:#181818;stroke-width:1.0;" x1="917.5" x2="917.5" y1="929.5078" y2="942.5078"/><line style="stroke:#181818;stroke-width:1.0;" x1="876.5" x2="917.5" y1="942.5078" y2="942.5078"/><polygon fill="#181818" points="886.5,938.5078,876.5,942.5078,886.5,946.5078,882.5,942.5078" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="882.5" y="924.4419">generate auth_code</text><polygon fill="#181818" points="1111.5,1023.6055,1121.5,1027.6055,1111.5,1031.6055,1115.5,1027.6055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="875.5" x2="1117.5" y1="1027.6055" y2="1027.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="882.5" y="1022.5396">put auth_code to k8s_redis</text><path d="M637,955.5078 L637,1086.5078 L860,1086.5078 L860,965.5078 L850,955.5078 L637,955.5078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M850,955.5078 L850,965.5078 L860,965.5078 L850,955.5078 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="643" y="972.5747">ttl: 300000 milliseconds (5 min)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="643" y="987.7075"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="643" y="1002.8403">Key: xxxxxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="643" y="1017.9731"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="643" y="1033.106">Value:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="643" y="1048.2388">- user_id</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="643" y="1063.3716">- scope</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="643" y="1078.5044"> </text><line style="stroke:#181818;stroke-width:1.0;" x1="1133.5" x2="1175.5" y1="1112.7031" y2="1112.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1175.5" x2="1175.5" y1="1112.7031" y2="1125.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1134.5" x2="1175.5" y1="1125.7031" y2="1125.7031"/><polygon fill="#181818" points="1144.5,1121.7031,1134.5,1125.7031,1144.5,1129.7031,1140.5,1125.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="1140.5" y="1107.6372">save data</text><polygon fill="#181818" points="886.5,1135.7031,876.5,1139.7031,886.5,1143.7031,882.5,1139.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="880.5" x2="1127.5" y1="1139.7031" y2="1139.7031"/><polygon fill="#181818" points="551,1164.8359,541,1168.8359,551,1172.8359,547,1168.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="545" x2="864.5" y1="1168.8359" y2="1168.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="557" y="1163.77">return</text><polygon fill="#181818" points="243,1234.8008,233,1238.8008,243,1242.8008,239,1238.8008" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="237" x2="534" y1="1238.8008" y2="1238.8008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="249" y="1233.7349">return</text><path d="M545,1181.8359 L545,1281.8359 L762,1281.8359 L762,1191.8359 L752,1181.8359 L545,1181.8359 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M752,1181.8359 L752,1191.8359 L762,1191.8359 L752,1181.8359 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="551" y="1198.9028">Response header</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="551" y="1214.0356">Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="551" y="1229.1685"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="551" y="1244.3013">Response body</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="551" y="1259.4341">- auth_code: xxxxxx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="551" y="1274.5669"> </text><!--MD5=[f6c0a6f9d565e16bdf55b3c583792c7d]
@startuml
title Autentication (username / password) flow
' autonumber
skinparam ParticipantPadding 100
skinparam BoxPadding 20


participant web
box NHSO

end box

box K8S_ZONE
participant bff_web_api
participant authentication_api
database k8s_redis
end box

box EC2_ZONE
participant user_api
database ec2_db
end box

activate web
web -> bff_web_api : /api/v1/auth/signInWithPassword

' activate authentication_api
note left
    Reuqest header
    Content-Type: application/json

    Request body
    - username: username
    - password: password

end note
activate bff_web_api

bff_web_api -> bff_web_api : validate request
bff_web_api -> authentication_api : /api/v1/auth/login
activate authentication_api
note left
    
    Request header
    Content-Type: application/x-www-form-urlencoded

    Request body
    - client_id: bff_web
    - username: username
    - password: password
    - grant_type: password
    - scope: bff_web

end note
authentication_api -> authentication_api : validate request
authentication_api -> k8s_redis : check existing users from k8s_redis
activate k8s_redis
k8s_redis - -> authentication_api: 
note right
    Redis object
    - user_id: xxxxxx
end note
deactivate k8s_redis
authentication_api -> user_api : /api/v1/validate-credentials
note left
    Reuqest header
    Content-Type: application/json

    Request body
    - username: username
    - password: password

end note
activate user_api
user_api -> user_api : validate reqiest
user_api -> ec2_db : query by username
activate ec2_db
ec2_db - -> user_api : return
deactivate ec2_db
user_api -> user_api : validate credentails

user_api - -> authentication_api: return
deactivate user_api
authentication_api -> authentication_api : generate auth_code
authentication_api -> k8s_redis : put auth_code to k8s_redis
activate k8s_redis
note left
    ttl: 300000 milliseconds (5 min)

    Key: xxxxxx

    Value:
    - user_id
    - scope

end note
k8s_redis -> k8s_redis: save data
k8s_redis - -> authentication_api
deactivate k8s_redis
deactivate user_api
' alt#Gold #LightBlue success
authentication_api - -> bff_web_api : return

bff_web_api - -> web : return
note right
    Response header
    Content-Type: application/json

    Response body
    - auth_code: xxxxxx
    
end note
deactivate authentication_api
|||
deactivate bff_web_api
deactivate web
@enduml

@startuml
title Autentication (username / password) flow
skinparam ParticipantPadding 100
skinparam BoxPadding 20


participant web
box NHSO

end box

box K8S_ZONE
participant bff_web_api
participant authentication_api
database k8s_redis
end box

box EC2_ZONE
participant user_api
database ec2_db
end box

activate web
web -> bff_web_api : /api/v1/auth/signInWithPassword

note left
    Reuqest header
    Content-Type: application/json

    Request body
    - username: username
    - password: password

end note
activate bff_web_api

bff_web_api -> bff_web_api : validate request
bff_web_api -> authentication_api : /api/v1/auth/login
activate authentication_api
note left
    
    Request header
    Content-Type: application/x-www-form-urlencoded

    Request body
    - client_id: bff_web
    - username: username
    - password: password
    - grant_type: password
    - scope: bff_web

end note
authentication_api -> authentication_api : validate request
authentication_api -> k8s_redis : check existing users from k8s_redis
activate k8s_redis
k8s_redis - -> authentication_api: 
note right
    Redis object
    - user_id: xxxxxx
end note
deactivate k8s_redis
authentication_api -> user_api : /api/v1/validate-credentials
note left
    Reuqest header
    Content-Type: application/json

    Request body
    - username: username
    - password: password

end note
activate user_api
user_api -> user_api : validate reqiest
user_api -> ec2_db : query by username
activate ec2_db
ec2_db - -> user_api : return
deactivate ec2_db
user_api -> user_api : validate credentails

user_api - -> authentication_api: return
deactivate user_api
authentication_api -> authentication_api : generate auth_code
authentication_api -> k8s_redis : put auth_code to k8s_redis
activate k8s_redis
note left
    ttl: 300000 milliseconds (5 min)

    Key: xxxxxx

    Value:
    - user_id
    - scope

end note
k8s_redis -> k8s_redis: save data
k8s_redis - -> authentication_api
deactivate k8s_redis
deactivate user_api
authentication_api - -> bff_web_api : return

bff_web_api - -> web : return
note right
    Response header
    Content-Type: application/json

    Response body
    - auth_code: xxxxxx
    
end note
deactivate authentication_api
|||
deactivate bff_web_api
deactivate web
@enduml

PlantUML version 1.2022.10beta1(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>